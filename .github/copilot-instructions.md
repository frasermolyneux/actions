# Copilot Instructions

- Purpose: this repo is a catalog of reusable composite GitHub Actions for .NET CI, Terraform automation, and deployment helpers. Each action lives in its own folder with an `action.yml` and `version.json` (for example, [dotnet-ci/action.yml](dotnet-ci/action.yml), [terraform-plan/action.yml](terraform-plan/action.yml)).
- Versioning: Nerdbank.GitVersioning runs per folder. Bump the folder's `version.json` when introducing feature or breaking changes; patch numbers derive from commit height. Pushes to `main` trigger [actions/.github/workflows/actions-versioning.yml](.github/workflows/actions-versioning.yml) to retag only the folders changed with `<folder>/vX.Y.Z`, `<folder>/vX.Y`, and `<folder>/vX` tags.
- .NET CI composites: [dotnet-ci](dotnet-ci/action.yml) restores/builds/tests solutions and uploads NuGet packages; [dotnet-web-ci](dotnet-web-ci/action.yml) adds publish plus optional framework-specific outputs; [dotnet-func-ci](dotnet-func-ci/action.yml) publishes Azure Functions and can upload either the framework root or `bin/Release`. All expect `perform-checkout` with `fetch-depth: 0`, run tests excluding `FullyQualifiedName~IntegrationTests`, use [dotnet-sdk-setup](dotnet-sdk-setup/action.yml) to install SDKs (handles stable/preview lists), and call [nbgv-metadata](nbgv-metadata/action.yml) to export build versions.
- Terraform composites: [terraform-plan](terraform-plan/action.yml) performs init/validate/plan with Azure OIDC (`AZURE_CLIENT_ID`, `AZURE_TENANT_ID`, `AZURE_SUBSCRIPTION_ID`), supports backend config via file or explicit inputs, uploads the plan, and can post PR comments via `terraform-pr-commenter`. [terraform-apply](terraform-apply/action.yml) downloads the plan artifact and applies it with the same OIDC env vars. [terraform-destroy](terraform-destroy/action.yml) runs init then destroy with var-file and optional backend overrides. Related helpers exist for plan-and-apply, plan-readonly, import, destroy-resources, and state removal; review their `action.yml` before use.
- Deployment helpers: folders under `deploy-*` (App Service, Function App, Logic App, SQL Database) and [logic-app-ci](logic-app-ci/action.yml) provide Azure deployment/build flows; confirm required inputs/secrets from each `action.yml` before wiring into workflows.
- Utilities: [run-api-integration-tests/action.yml](run-api-integration-tests/action.yml) executes API integration tests; [publish-nuget-packages/action.yml](publish-nuget-packages/action.yml) pushes packages; [bicep-lint-code/action.yml](bicep-lint-code/action.yml) checks Bicep templates; [terraform-state-rm/action.yml](terraform-state-rm/action.yml) cleans Terraform state.
- Workflow badges: repository workflows include actions-versioning, codequality (SonarCloud + CodeQL + composite builds), dependabot-automerge, and devops-secure-scanning.
- Shell conventions: steps mix bash and PowerShell; defaults target `ubuntu-latest`. Actions commonly rely on package caching (`actions/cache`) and artifacts (`actions/upload-artifact` / `download-artifact`). Keep checkouts at `fetch-depth: 0` to satisfy NBGV and code scanning requirements.
- Documentation: see [docs/action-versioning.md](docs/action-versioning.md) for tag shapes, [docs/codequality.md](docs/codequality.md) for the reusable workflow inputs, and [docs/nerdbank-gitversioning.md](docs/nerdbank-gitversioning.md) for NBGV expectations.

If anything here feels incomplete or unclear, let me know so we can tighten these notes.